<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
<title>Podex -- rozhraní 68HC12 BDM -- Podex, 68HC12 BDM</title>
</head>
<body>
<table border="0" width="100%"><tr>
<td valign="top" align="left"><ul>
<li>
<i>Podex, 68HC12 BDM</i><ul>
<li><a href="index.html#1-1">Co je BDM Motoroly HC12?</a></li>
<li><a href="index.html#1-2">Co je podex (BDM "pod")?</a></li>
<li><a href="index.html#1-3">S èím podex funguje?</a></li>
<li>
<a href="index.html#1-4">Nìjaká lep¹í øe¹ení?</a><ul><li><a href="index.html#1-4-1">Odkazy</a></li></ul>
</li>
</ul>
</li>
<li><a href="podex_hw.html">Hardware</a></li>
<li><a href="podex_fw.html">Firmware (program unvitø podexu)</a></li>
<li><a href="podex_gdb.html">Software</a></li>
<li><a href="podex_eg.html">Pøíklad pou¾ití</a></li>
<li><a href="podex_faq.html">ÈKD</a></li>
</ul></td>
<td valign="bottom" align="right">
<h1>Podex, 68HC12 BDM</h1>[ <a href="index.en.html">english</a> ]</td>
</tr></table>
<hr>
<a name="index"></a>

<a name="1-1"></a><h2>Co je BDM Motoroly HC12?</h2>

<p>BDM (background debugging mode) u procesorù Motorola øady 68HC12 se
nazývá</p>
<ul>
<li>zvlá¹tní re¾im procesoru, v nìm¾ je mo¾né zasahovat do vykonávání
programu, èíst a zapisovat do pamìti a registrù, ladit program
(nastavovat breakpointy, watchpointy, krokovat)</li>
<li>rozhraní procesoru HC12, jím¾ je mo¾né re¾im BDM ovládat (z
jiného poèítaèe)</li>
</ul>
<p>Rozhraní BDM se pou¾ívá jak na ladìní programù v jednoèipových
poèítaèích HC12, tak na programování pamìtí FLASH tìchto poèítaèù. BDM
je u HC12 nejschùdnìj¹í cestou k naprogramování vnitøní pamìti FLASH
procesoru, lze jím ov¹em programovat i pamìti vnìj¹í, které bývají
osazeny napøíklad na nìkterých vývojových deskách.
</p>
<p>BDM, pou¾ívané u procesorù Motorola HC12, je uplatnìno pouze v
procesorech této øady. Odli¹né rozhraní (se stejným názvem BDM a
podobnou funkcí) pou¾ívá Motorola napøíklad pro 32bitovou øadu 68300.
Jiným, obdobným, ale obecnìj¹ím rozhraním, pou¾ívaným mnoha výrobci jak
v procesorech a jednoèipových poèítaèích, tak v programovatelných
logických polích a pamìtech, je <a href="http://www.inaccessnetworks.com/projects/ianjtag/jtag-intro/jtag-intro.html">JTAG</a>.
</p>

<a name="1-2"></a><h2>Co je podex (BDM "pod")?</h2>

<p>Ná¹ podex je rozhraní (v hmatatelném smyslu, tj. krabièka,
zapojení -- dále jen "krabièka"), propojující BDM procesoru HC12 s
jiným poèítaèem (z nìho¾ se
HC12 programuje a ladí). Podex se z jedné strany pøipojuje k
rozhraní BDM (standardní 6tipólový nebo roz¹íøený 10tipólový konektor)
a z druhé k sériovému portu RS232 poèítaèe. Pracuje dobøe i s
pøevodníkem USB-RS232 a mìl by spolupracovat i s jinými poèítaèi, ne¾
Intel/IBM PC.
</p>
<p>Schéma zapojení, návod na výrobu a program (firmware) pro jednoèip,
v podexu obsa¾ený, je zde zveøejnìn zdarma. Cena souèástek se
pohybuje kolem 150Kè (a stále klesá...).
</p>
<p>V dobì vývoje podexu mi byly ze v¹ech mnoha stávajících
BDM krabièek známy pouze dvì, u nich¾ bylo zveøejnìno schéma zapojení:
</p>
<ul>
<li>krabièka Malte Avenhause, její¾ autor zveøejnil i firmware
jednoèipu; tato krabièka ale bohu¾el není, pokud je mi známo,
podporována ¾ádným debuggerem</li>
<li>krabièka Kevina Rosse, která je komerèní, ale prodávána jako
stavebnice; jako jediná vedle Malte Avenhause mìla zveøejnìn
komunikaèní
protokol a je podporována dvìma komerèními
debuggery a GNU gdb</li>
</ul>
<p>Podex byl navr¾en tak, aby byl protokolovì sluèitelný s
krabièkou Kevina Rosse. Hlavním cílem bylo vytvoøit levnou a volnì
dostupnou BDM krabièku, která bude pracovat s GNU gdb debuggerem.
Pova¾uji za lep¹í øe¹ení pou¾ít protokol Kevina Rosse (by» je ponìkud
pøihlouplý), pro nìj¾ je ji¾ v GNU gdb rozpracována podpora (a roz¹íøit
tak její pou¾ití, spolu s více u¾ivateli i vychytat víc chyb), ne¾
vytvoøit dal¹í, funkènì stejný protokol a cpát do gdb nadbyteènou
podporu pro zhruba tu samou vìc.
</p>
<p>Podex spojuje jednovodièové obousmìrné rozhraní BDM (které vy¾aduje
pomìrnì pøesné èasování a není proto mo¾né realizovat èistì programovì
bez dodr¾ení nìkterých dùle¾itých èasových rozmezí) se sériovou linkou
nadøazeného poèítaèe. Naprostou vìt¹inu datového provozu podex pouze
pøedává mezi sériovou linkou a BDM, zbytek pak tvoøí ze strany poèítaèe
nìkteré slu¾ební pøíkazy, jako nastavení èasové konstanty BDM (podle
rychlosti, na které bì¾í HC12) nebo ovládání signálu RESET procesoru
HC12, který je rovnì¾ k podexu pøipojen. Podex je navr¾en na základì
jednoèipového poèítaèe Atmel øady AVR, v pøedstavovaném zapojení
konkrétnì modelu AT90S2313. Z pou¾ití jednoèipu jako pøevodníku BDM
(oproti pou¾ití napøíklad hradlového pole) plyne ov¹em omezení
frekvence BDM sbìrnice (a tedy i frekvence, na ní¾ bì¾í pøipojený HC12
procesor).
</p>

<a name="1-3"></a><h2>S èím podex funguje?</h2>

<p>Podex je mo¾no pøipojit k BDM v¹ech jednoèipových poèítaèù, desek a
zaøízení, postavených na jádru Motorola HC12 nebo HCS12, která mají
</p>
<ul>
<li>frekvenci BDM (rovná polovinì taktovací frekvence) nejvý¹e zhruba
rovnou frekvenci pou¾itého jednoèipu AVR v podexu; tedy v pøedstaveném
zapojení s krystalem 9.216MHz je mo¾né pracovat s HC12 o taktovacích
frekvencích do cca. 18..22MHz</li>
<li>napájení 5V (stejnì jako pou¾itý AVR jednoèip); mo¾ná èasem
zkusím odzkou¹et pøevodník BDM na 3V, dal¹ím øe¹ením by bylo pou¾ít 3V
AVR (ty bývají ale zase pomalej¹í)</li>
</ul>
<p>Podex spolupracuje s debuggery:
</p>
<ul>
<li><a href="http://www.noicedebugger.com/help/bdm12.htm">NoICE Debugger</a></li>
<li>
<a href="http://www.softtools.com/">Sid Price</a> --
    <a href="http://www.softtools.com/stingray_bdm12_features.htm">StingRay 68HC12</a> debugger</li>
<li>
<a href="http://www.gnu.org/software/gdb/">GNU gdb</a> -- hlavní 
podporovaný debugger (a myslím, ¾e vùbec nejlep¹í debugger ze v¹ech), k pou¾ití
spolu se sadou <a href="http://stephane.carrez.free.fr/m68hc11_port.php">GNU
m68hc1x nástrojù binutils a gcc</a>
  </li>
</ul>

<a name="1-4"></a><h2>Nìjaká lep¹í øe¹ení?</h2>

<p>Podex vznikl z okam¾ité potøeby BDM krabièky asi za dva mìsíce
(nechtìlo se nám draze platit, zvlá¹» kdy¾ se na pracovi¹tích fakulty a
mezi studenty zøejmì u¾iví v budoucnu takových krabièek hodnì). Hlavním
cílem byla nízká cena, snadná výroba a okam¾itá pou¾itelnost (a podpora
v GNU gdb). Nejedná se tedy o projekt na technické ¹pièce, o ojedinìlé
ani výkonem nepøekonané zaøízení. Pro úplnost zkusím uvést nìkterá
mo¾ná lep¹í øe¹ení èi zlep¹ení:
</p>
<ul>
<li>rychlej¹í jednoèip v podexu -- u¾ivatel, vy¾adující práci s
rychleji taktovanými HC12, mù¾e zkusit pou¾ít rychlej¹í procesor øady
AVR, postaèí zmìnit jednu èasovací konstantu v zdrojovém kódu firmwaru
(a pøípadnì plo¹ný spoj)</li>
<li>pøímé pou¾ití USB -- bylo by mo¾no pou¾ít jednoèip s pøímou
podporou USB (pøípadnì s nìjakým vnìj¹ím øadièem) s výhodou vy¹¹í
rychlosti pøenosu mezi krabièkou a poèítaèem a snadnìj¹ího pøipojení k
poèítaèùm s USB bez sériového portu; v podexu byla ov¹em dána pøednost
sériovému portu pro jeho jednoznaènì nej¹ir¹í podporu (asynchronní
pøenos se start a stopbity ji¾ od konce 19. století), pro mo¾nost
pøipojení k USB pøes pøevodník (USB zaøízení se naopak k sériovému
portu pøipojuje velmi obtí¾nì); velmi zajímavou mo¾ností USB by bylo
pøipojit bez úèasti jednoèipu BDM rozhraní k pøevodníku mezi USB a
programovatelným synchronním sériovým portem, jakým je napøíklad obvod
FT2232C -- to ale nemám promy¹leno a nevím, jestli by to bylo mo¾né</li>
<li>pou¾ití programovatelného sériového øadièe -- existují obvody,
jimi¾ by zøejmì bylo mo¾né vytvoøit protìj¹ek rozhraní BDM vhodným
naprogramováním; takové øadièe jsou obsa¾eny v nìkterých jednoèipech
(Hitachi)</li>
<li>pou¾ití hradlového pole (nebo logických obvodù) -- dle mého
názoru nejzajímavìj¹í øe¹ení, umo¾òující co nejvy¹¹í frekvence BDM; ve
skuteènosti by staèilo naprogramovat do hradlového pole vysílání a
pøíjem jedinéoho bitu pøes BDM (to se odehrává v 16ti taktech), na to
by mo¾ná staèila i opravdu malièká pole (GAL22V10?); obvod by se pak
pøipojil k paralelnímu portu (Centronics-LPT) èi k pøevodníku USB
(FT245, FT2232C) -- pokud mi v budoucnu pohádkový dìdeèek vìnuje
kouzelnou mo¹nu s èasem, rád tuto variantu vyzkou¹ím a zkusím upravit
podporu v GNU gdb, aby byla co nejvíce spoleèná pro podex i hradlové
pole</li>
<li>podpora více rozhraní (BDM jiných procesorù, JTAG) -- jistì je
výhodné mít univerzální zaøízení k programování a ladìní rozsáhlej¹í
mno¾iny procesorù a souèástek, ne¾ je jen øada HC12; podex ale je
a  zùstane malým a levným prostøedkem pro HC12 -- zájemci o
rozsáhlej¹í øe¹ení je (snad brzy) najdou jinde
  </li>
</ul>
<a name="1-4-1"></a><h3>Odkazy</h3>

<p>Zde je nìkolik odkazù na¹e nejdùle¾itìj¹í konkurenty a pøíbuzné:</p>
<ul>
<li>Armand ten Doeschatte, Karl Ran a jejich
    <a href="http://savannah.nongnu.org/projects/freeice">Free AVR
    ICE / GDB-Serializer</a> (pro AVR (s JTAGem), arm7/9 (JTAG), 68HC08,
    683xx, 68HC16, 68HC12, coldfire)</li>
<li>
<a href="http://cmp.felk.cvut.cz/~pisa/">Ing. Pavel Pí¹a</a>,
    FEL ÈVUT a jeho <a name="pavel-pisa"></a>
    <a href="http://cmp.felk.cvut.cz/~pisa/m683xx/bdm_driver.html">BDM/GDB
    pro 683xx</a>
</li>
<li>
<a name="zdenek-rozehnal"></a><a href="http://micro.feld.cvut.cz/~rozehnal/">Ing. Zdenìk Rozehnal,
  Csc.</a>, FEL ÈVUT, pracující na BDM rozhraní tvoøeném
  hradlovým polem</li>
<li>
<a href="http://www.kevinro.com/products.html">Kevin Ross</a>
  -- <a href="http://www.kevinro.com/bdm12.pdf">BDM12</a>, krabièka,
  s ní¾ se podex sna¾í být kompatibilní</li>
<li>
<a name="malte-avenhaus"></a><a href="http://www.avenhaus.de/Malte/BDM12/">Malte Avenhaus</a>
  -- první nám známý tvùrce BDM s volnì dostupným zdrojovým kódem</li>
</ul>


<p></p>
<br><hr size="1">
<table border="0" width="100%"><tr>
<td align="left"><em>Podex -- rozhraní 68HC12 BDM</em></td>
<td align="center"><a href="http://duch.cz/podex/">http://duch.cz/podex/</a></td>
<td align="right">
<em>Marek Peca,</em> &lt;<a href="mailto:marek@duch.cz">marek@duch.cz</a>&gt;</td>
</tr></table>
</body>
</html>
