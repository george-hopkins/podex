<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
<title>Podex -- rozhraní 68HC12 BDM -- Hardware</title>
</head>
<body>
<table border="0" width="100%"><tr>
<td valign="top" align="left"><ul>
<li><a href="index.html">Podex, 68HC12 BDM</a></li>
<li>
<i>Hardware</i><ul>
<li><a href="podex_hw.html#2-1">Zapojení</a></li>
<li>
<a href="podex_hw.html#2-2">Stavba</a><ul>
<li><a href="podex_hw.html#2-2-1">Plo¹ný spoj</a></li>
<li><a href="podex_hw.html#2-2-2">Seznam souèástek</a></li>
</ul>
</li>
<li><a href="podex_hw.html#2-3">Programování firmware</a></li>
</ul>
</li>
<li><a href="podex_fw.html">Firmware (program unvitø podexu)</a></li>
<li><a href="podex_gdb.html">Software</a></li>
<li><a href="podex_eg.html">Pøíklad pou¾ití</a></li>
<li><a href="podex_faq.html">ÈKD</a></li>
</ul></td>
<td valign="bottom" align="right">
<h1>Hardware</h1>[ <a href="podex_hw.en.html">english</a> ]</td>
</tr></table>
<hr>
<a name="podex_hw"></a>

<a name="2-1"></a><h2>Zapojení</h2>

<p>Pøipojit k jednoèipu jeden drát a z druhé strany RS232 je stejnì
objevné a tajuplné, jako zapojit ¾árovku k baterii v kapesní svítilnì.
</p>
<table border="0">
<tr><td align="center"><img src="hw/podex_sch.gif" alt="Schéma zapojení podexu"></td></tr>
<tr><td align="center"><em>Schéma zapojení podexu</em></td></tr>
</table>
<p>Signály TxD, RxD, RTS, CTS (v schématu znaèeno z hlediska podexu)
sériového rozhraní RS232 jsou k jednoèipu AVR pøipojeny pøes budiè U2,
MAX232. V prototypu byla pou¾ita "hor¹í" a levnìj¹í varianta MAX232 bez
pøípony A, k ní¾ by mìly být pøipojeny kondenzátory 1uF (na plo¹ném
spoji formát 1206). Tyto mohou být tantalové, ale dají se sehnat i
keramické té¾e velikosti (ten pokrok, kde se to zastaví...). Konektor
K1 je mo¾no zapojit pøímo do sériového portu IBM PC. Svítivé diody D1,
D2 slou¾í jako ukazatele èinnosti a chybového stavu a rovnì¾ mohou být
libovolnì ovládány z programu øídicího poèítaèe. Na konektor K3 jsou
vyvedeny signály MOSI, MISO, SCK sériového programovacího rozhraní
AT90S2313 a signál /RESET, kterými (spolu s pøipojenou zemí GND
konektoru K1 nebo K2) je do FLASHe jednoèipu AVR nahráván firmware.
Plo¹ný spoj umo¾òuje pøipojit spínaè S1 na vynulování AVR (nemìlo by
být potøeba). Hodinový signál jednoèipu je èerpán z krystalu X1 o
frekvenci nejlépe 9.216MHz -- nejvy¹¹í výrobcem udaná frekvence pro 5V
AT90S2313 je 10MHz a 9.216MHz je nejbli¾¹í ni¾¹í frekvencí, z ní¾ lze
dobøe vydìlit takt pro 115200b/s sériový pøenos. Krystal je pøipojen
pøes propojku J1, kterou je mo¾no rozpojit a hodiny èerpat zvenèí pøes
konektor K2, napøíklad ze signálu EClock procesoru HC12. Na konektor
K2, urèený k pøipojení BDM, je kromì zmínìných hodin a napájení vyveden
tøístavový signál BDM (BKGD), signál /RESET a dále programovì ovládané
linky MODA, MODB umo¾òující práci s roz¹íøenou pamìtí (sbìrnicí) procesoru
HC12.
</p>

<a name="2-2"></a><h2>Stavba</h2>

<p>Podex byl navr¾en na oboustranném plo¹ném spoji s oboustrannou
povrchovou montá¾í souèástek. Neju¾¹í mezera je
¹iroká pøibli¾nì 0.2mm, ale na <a href="http://www.fm.vslib.cz/~kes/pcb_lab/">bájeèném a levném pracovi¹ti v Liberci</a>, kde
oficiálnì podporují mezery a spoje nad 0.25mm, vyrobili destièky moc hezky.
Destièka je urèena k umístìní do krytky na dva
protilehlé konektory Canon DB9. Je vsunuta mezi pájecí ¹pièky (slou¾ící
obvykle k pájení vodièù kabelu) tìchto konektorù a povrchovì pøipájena
k tìmto ¹pièkám plo¹kami na desce. Konektory tedy zároveò dr¾í destièku
v krytce. Konektor K1 je samièí, aby odpovídal zapojení RS232, K2
samèí, aby nedo¹lo k jejich zámìnì. Svítivé diody byly pou¾ity kruhové
o prùmìru 3mm, pokud budou
osazeny, není od vìci vyvrtat pro nì otvory v krytce. Jako programovací
konektor K3 jsem pou¾il 4 dutinky "precizní" lámací li¹ty -- pozor, aby
se souèástky do krytky ve¹ly. Propojku J1 mù¾ete natvrdo propojit,
nebudete-li pou¾ívat vnìj¹ích hodin (jinak ji nechte rozpojenu). Spínaè
S1 nejspí¹e nebudete nikdy potøebovat. Pokud se vám nehodí navr¾ený
plo¹ný spoj nebo jej nemáte kde objednat, postavte si zapojení na desce
univerzálního plo¹ného spoje -- obvod je velmi jednoduchý.
</p>
<a name="2-2-1"></a><h3>Plo¹ný spoj</h3>

<table border="1" cellspacing="0" cellpadding="3">
<tr>
<td><table border="0">
<tr><td align="center"><img src="hw/podex_pcb_front.gif" alt="plo¹ný spoj (horní vrstva)"></td></tr>
<tr><td align="center"><em>plo¹ný spoj (horní vrstva)</em></td></tr>
</table></td>
<td><table border="0">
<tr><td align="center"><img src="hw/podex_pcb_back.gif" alt="plo¹ný spoj (spodní vrstva)"></td></tr>
<tr><td align="center"><em>plo¹ný spoj (spodní vrstva)</em></td></tr>
</table></td>
</tr>
<tr>
<td><table border="0">
<tr><td align="center"><img src="hw/podex_asmbl_front.gif" alt="osazení desky (shora)"></td></tr>
<tr><td align="center"><em>osazení desky (shora)</em></td></tr>
</table></td>
<td><table border="0">
<tr><td align="center"><img src="hw/podex_asmbl_back.gif" alt="osazení desky (zdola)"></td></tr>
<tr><td align="center"><em>osazení desky (zdola)</em></td></tr>
</table></td>
</tr>
<tr><td colspan="2">
    <ul>
<li><a href="hw/podex_pcb.zip">podklady pro výrobu
        plo¹ných spojù ve formátu Gerber a vrtací souøadnice</a></li>
<li>obrazce plo¹ných spojù a rozmístìní souèástek ve formátu
        <a href="hw/podex_pcb_eps.zip">EPS (zabalené)</a> a
        <a href="hw/podex_pcb.pdf">vcelku v PDF</a>
</li>
</ul>
  </td></tr>
</table>

<a name="2-2-2"></a><h3>Seznam souèástek</h3>


  
<table border="1" cellspacing="0" cellpadding="3">
<tr>
<td>
      <em>oznaèení</em>
    </td>
<td>
      <em>typ</em>
    </td>
<td>
      <em>pouzdro</em>
    </td>
<td>
      <em>hodnota</em>
    </td>
</tr>
<tr>
<td>U1</td>
<td>AT90S2313</td>
<td>SO20W</td>
<td></td>
</tr>
<tr>
<td>U2</td>
<td>MAX232</td>
<td>SO16</td>
<td></td>
</tr>
<tr>
<td>K1, K2</td>
<td>DB9</td>
<td>DB9SM</td>
<td></td>
</tr>
<tr>
<td>D1</td>
<td>LED</td>
<td>LED_3mm</td>
<td>R</td>
</tr>
<tr>
<td>D2</td>
<td>LED</td>
<td>LED_3mm</td>
<td>G</td>
</tr>
<tr>
<td>C1, C2</td>
<td>CAPACITOR</td>
<td>0805</td>
<td>33p</td>
</tr>
<tr>
<td>C8</td>
<td>CAPACITOR</td>
<td>0805</td>
<td>u1</td>
</tr>
<tr>
<td>R1, R2</td>
<td>RESISTOR</td>
<td>0805</td>
<td>330</td>
</tr>
<tr>
<td>R3</td>
<td>RESISTOR</td>
<td>0805</td>
<td>10k</td>
</tr>
<tr>
<td>S1</td>
<td>SWITCH_PUSHBUTTON_NO</td>
<td>JUMPER2</td>
<td></td>
</tr>
<tr>
<td>X1</td>
<td>CRYSTAL</td>
<td>HC49</td>
<td>9.216MHz</td>
</tr>
<tr>
<td>J1</td>
<td>JUMPER</td>
<td>JUMPER2</td>
<td></td>
</tr>
<tr>
<td>C3, C4, C5, C6, C7</td>
<td>CAPACITOR</td>
<td>1206</td>
<td>1u</td>
</tr>
<tr>
<td>K3</td>
<td>HEADER3</td>
<td>JUMPER4</td>
<td></td>
</tr>
</table>



<p>Krabièka podexu se propojuje s øídicím poèítaèem buï pøímým
zasunutím do RS232 DB9 konektoru, nebo propojovacím kabelem, který
ov¹em musí obsahovat i RTS  a CTS signály. Pro BDM rozhraní je
dokumentací k procesorùm HC12 stanoven standardní 6tipólový konektor,
pro pou¾ívání linek MODA, MODB je doporuèeno jeho 10tipólové roz¹íøení.
Konektor K2 je zapojen tak, aby jej bylo mo¾né propojit kabelem AWG se
samoøezným konektorem DB9 na stranì podexu a 6ti(10ti)pólovým
samoøezným konektorem PFL na druhém konci.
</p>
<table border="0">
<tr><td align="center"><img src="hw/podex_bdm.gif" alt="Zapojení konektorù BDM"></td></tr>
<tr><td align="center"><em>Zapojení konektorù BDM</em></td></tr>
</table>
<img src="hw/podex_bdm_foto.gif" width="800" height="200" alt="fotka">

<a name="2-3"></a><h2>Programování firmware</h2>

<p>Firmware je do FLASH pamìti AVR AT90S2313 nahráván pøes konektor K3.
K programování staèí propojit signály sériového programovacího rozhraní
s paralelním portem LPT/Centronics dle náledujícího, mezi u¾ivateli AVR
ustáleného, zapojení (Direct AVR Parallel Access):</p>
<table border="0">
<tr><td align="center"><img src="hw/avr_dapa.gif" alt="Zapojení programátoru AVR pøes LPT"></td></tr>
<tr><td align="center"><em>Zapojení programátoru AVR pøes LPT</em></td></tr>
</table>
<p>Pozor, kromì signálù vyvedených na konektoru K3 je tøeba propojit s
programovacím poèítaèem i zem (GND), nejlépe konektorem K1. Zároveò je
samozøejmì nutné napájet programovaný podex 5V pøes konektor K2 (je
mo¾né napájet jej z desky s HC12, nejsou-li pøipojeny linky MODA,
MODB).</p>
<p>S takovýmto zapojením na paralelní port lze podex naprogramovat
napøíklad programem <a href="http://www.nongnu.org/uisp/">uisp</a>.
Pøipravený <a href="podex_fw.html#podex-hex">firmware</a> se nahraje
napøíklad pøíkazem</p>
<blockquote><table border="1" cellspacing="0" cellpadding="3"><tr><td><pre>
uisp -dlpt=0x378 -dprog=dapa --erase --upload --verify if=podex.hex -v=3 --hash=12
</pre></td></tr></table></blockquote>
<p>(0x378 je základ adresy LPT portu, podex.hex je jméno souboru s
firmwarem, více viz v dokumentaci k uisp). Naprogramováním firmware je podex
hotov a schopen práce s HC12.</p>

<p></p>
<br><hr size="1">
<table border="0" width="100%"><tr>
<td align="left"><em>Podex -- rozhraní 68HC12 BDM</em></td>
<td align="center"><a href="http://duch.cz/podex/">http://duch.cz/podex/</a></td>
<td align="right">
<em>Marek Peca,</em> &lt;<a href="mailto:marek@duch.cz">marek@duch.cz</a>&gt;</td>
</tr></table>
</body>
</html>
